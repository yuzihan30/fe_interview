## 大数据数仓平台构建思路及落地深度剖析
- 数据分析平台业务落地痛点分析
- ER实体关系与范式建模设计与实战案例
- 构建企业战略决策数仓平台原因剖析
- 自上而下与自下而上构建EDW优缺点分析
- 数据仓库维度建模之事实表与维度表划分
- 星型模型、雪花模型、星座模型对比分析
- 企业级数据仓库通用分层设计划分
- 企业级数据仓库案例及数据分层落地实践

### 数据分析业务痛点分析

#### 项目数据 点歌系统
- 业务系统数据-存放关系型数据库
- 用户日志数据-用户在系统产生
    * 用户点播歌曲日志数据
- 问题
javaweb日志数据存储在哪？
可以放mysql，但不会放mysql中，因为mysql存储的是事务型操作类型的数据
如何统计歌手或者歌曲实时热度？
随着数据量增大，sql去查会非常慢
点播中没有歌手信息怎么办？
没关联时查询慢，关联查询就更慢
使用VUE平台开发WEB平台实时展示效果？
实时，没有交互，自动展示，只需要大屏展示，不需要点；使用vue就浪费物力、财力；
使用开发工具实现
实时点播数一直轮训数据库？数据量大效率低怎么办？
mysql数据超过2000万的时候，即使加了索引什么的，只要有一点点关联效率就会非常低

#### 如何构建大数据平台
每个大数据公司构建大数据平台最重要的一环
构建数据仓库平台

### 范式建模与ER实体关系
#### Java Web为什么需要大数据？
- 场景一：
抖音平台：点赞、评论、私信、广告、浏览记录、商品数据、交易订单
会出现数据存储瓶颈
- 场景二：
电影网站-"热搜榜单"、"喜剧榜单"、"动作榜单"、周、月度排行
数据计算有瓶颈
- 场景三：
实时交易数据，实时人数统计？
实时场景计算有瓶颈
- 场景四：
京东、淘宝、当当平台商品推荐如何解决？
- 还有其他的
比如企业内部数据孤岛问题
那我们怎么办呢？构建大数据平台
#### 范式建模与ER实体关系模型
- 数据库三范式
    * 第一范式（1NF):原子性，字段不可分 normal form 一般的格式
    * 第二范式（2NF):唯一性，有主键，非主键字段依赖主键 （满足第一范式的基础上） 需要避免信息冗余
    * 第三范式（3NF):非主键字段不能相互依赖 （满足第一、二范式的基础上）
    需要避免信息冗余,范式级别越高，冗余越小；和第二范式有点相似
- ER实体关系模型
数据库设计的理论基础，事务或者事件分成三个部分，实体（对象）、属性（对实体的描述）、关系（实体不是孤立存在的，实体和实体之间是有关系的）, 往往关系的产生会伴随实体属性的产生
- ER案例
ER实体关系模型案例
电商购物系统中，对商品、用户设计ER实体关系模型图表示业务联系，如何实现？
步骤：1、从业务中抽离出实体，用户、商品
2、找出实体与实体之间的关系，购买关系
3、找出实体的属性，购买关系产生的属性有商品数量、交易额、购买时间、配送方式
4、画出ER关系图（一般是项目经理画的）
5、设计数据库表，就是根据ER实体关系模型图把表画出来就行了

### 构建企业级数据仓库
原因、痛点
#### 为什么要构建数据仓库
构建数据仓库仅仅是因为数据量大，MySQL存储不下吗？
1、数据存储在互不兼容的系统中
2、关系型数据库一般不存储日志数据
MySQL一般存的是支撑web平台正常运转的增删改查的事务性操作
路径行为，分析取消订单的原因,是因为付款出问题撤销订单还是因为又浏览其他商品撤销；这就是漏斗分析
3、决策者需要从商业角度观察数据，关系型数据不合适
#### 什么是数据仓库
数据仓库是面向主题的、集成的(非简单的数据堆积)、相对稳定的、反映历史变化的数据集合，数仓中的数据是有组织有结构的存储数据集合，用于对管理决策过程的支持
面向主题：面向某个角度
集成：消歧，字段的统一化处理，数据一致性处理
#### 数据仓库发展历史
1. 萌芽阶段（1978-1988）
将业务处理系统和分析系统分开
2. 探索阶段（1988年左右）
DEC公司提出TA2规范，定义分析系统四个部分：数据获取、数据访问、目录和用户服务
目录，提供数据的描述性信息，大小，位置等
用户服务就是对外提供服务
3. 雏形阶段（1988年左右）
IBM信息仓库，数据抽取、转换、有效性验证、加载、Cube开发、图像化查询工具
数据抽取转换加载就是ETL
有效性验证就是全不全、丢没丢、错没错
4. 确定阶段（1991年）
比尔.恩门，《Building the Data Warehouse》, "数据仓库之父"
数据仓库是面向主题的（Subject-Oriented）;集成的（integrated）;包含历史的（Time-variant）;不可更新的（Nonvolatile）;面向决策支持的（Decision Support）;面向企业的（Enterprise Scope）;最明细的数据存储（Atomic Detail）: 不可删除;数据快照式的数据获取（Snap Shot Capture）
- 构建方式
自上而下，根据业务部门的需要，缺点：范式建模，很多小表关联一个结果的时候存在效率低的问题
5. 确立阶段（1994年）
拉尔夫.金博尔 《The DataWarehouse Toolkit》, 维度建模
OLAP自下而上的方式构建数据仓库，提出数据集市的概念，数据集市直接存储在数仓里，业务系统的表直接拿过来，想怎么聚合怎么聚合，先聚合出来，最终提供结果时是从不同集市中关联结果对外提供。最终关联的时候不知道按照谁，因为不同业务系统对应不同的集市，没有把数据抽离出来做一致性处理，对外提供的时候数据就乱套了
冗余在这里不叫多大的问题
6. 争吵与混乱（1996-1997年）
比尔.恩门派 & 拉尔夫.金博尔派
7. 合并（1998-2001年）
比尔.恩门提出CIF架构：数仓分层，不同层采用不同的建模方式
### 维度建模与数据分析模型
OLTP是关系型数据库的操作，事务处理
OLAP数据分析
- 维度建模
拉尔夫.金博尔派提出维度建模，维度建模主要面向分析场景
事实表，现实世界中每一个某一个操作型的事件都可以存在事实表里面
地区ID、产品ID、月份ID叫维度列，销售量和销售额叫度量列，维度列加上度量列叫fact table, 度量列一般是可度量的数字列
cube开发就是OLAP分析里面任意列的组合查询对应的结果
维度列存数字而不存名称，村名称的话高表占用空间非常大，表越大关联的效率要低；针对上面的维度列，都会关联一张维度表与之对应，维度表相当于关系型数据库的主键唯一的表，在数据仓库虽然没有所谓的表、主键的概念，另外还有缓慢变化维度表；事实表用fact开头表示，维度表用dim开头表示
#### 数据分析模型
根据事实表和维度表的关联方式会衍生出很多数据分析模型
1. 星型模型：事实表中的贷款合同号没有额外的维度，叫退化维度，所以就放在事实表中；缺点，地区维度表有一定数据冗余，但只关联一层就能关联到
有数据冗余，但分析效率高
2. 雪花模型
地区ID的时候，地区维度表有国家ID、省份ID、城市ID, 这些ID又对应不同的表，组织这些数据的时候更加范式化的构建了这些表的关系，小表非常多
中间有一张实时表，关联到这张维度表的时候，还需要更多的维度表去关联
数据冗余没有星型多，但需要处理大宽表，需要关联的表特别多
没有数据冗余，但分析效率低
优先使用星型模型
3. 两种模型对比
星型模型违范式建模，雪花模型范式建模
星型模型的数据分析效率比雪花模型效率高，优先选择星型模型
企业级数据仓库构建使用星型模型和星座模型居多
4. 星座模型
星型模型共享一些维度表构成星座模型
